$(document).ready(function(){

	$( "#memory_date_cal" ).datepicker({ dateFormat: 'yy-mm-dd', altField: "#memory_date" });

	$("#memory_date").keydown(function(event) {
      // Allow: backspace, delete, tab, escape, and enter
      if ( event.keyCode == 46 || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 27 || event.keyCode == 13 || 
           // Allow: Ctrl+A
          (event.keyCode == 65 && event.ctrlKey === true) || 
           // Allow: home, end, left, right
          (event.keyCode >= 35 && event.keyCode <= 39)) {
               // let it happen, don't do anything
               return;
      }
      else {
          // Ensure that it is a number and stop the keypress
          if (event.shiftKey || (event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105 )) {
              event.preventDefault(); 
          }   
      }
  });
	$('a').tooltip({
  	placement : 'bottom'
  });
  $('button').tooltip({
  	placement : 'bottom'
  });
   $('i').tooltip({
  	placement : 'bottom'
  });
  $('img').tooltip({
  	placement : 'top'
  });
	$(".tooltip").tooltip();
  $("a[rel=tooltip]").tooltip();

	$(".icon-off, .icon-cog, .iconaddcontributor, .playslideshow, .skipquestion, .iconsignout, .iconhelp, .iconfamtree").fadeTo("fast", 0.6);
	$(".icon-off, .icon-cog, .iconaddcontributor, .playslideshow, .skipquestion, .iconsignout, .iconhelp, .iconfamtree").hover(function() {
		$(this).fadeTo('fast',1);
	}, function() {
   	$(this).fadeTo("fast", 0.6);
 	});
	$(".iconaddcontributor, .playslideshow").click(function() {
		$(this).fadeTo('fast',1);
	});

	$(".newmemorybtn").fadeTo("fast", 0.8);
	$(".newmemorybtn").hover(function() {
		$(this).fadeTo('fast',1);
	}, function() {
   	$(this).fadeTo("fast", 0.8);
 	});

 	$(".nav_right.hotspot").hover(function() {
		$('.nav_controls.right').fadeTo("fast",0.5);
	}, function() {
	  $('.nav_controls.right').fadeTo("fast", 0);
 	});

 	$(".nav_left.hotspot").hover(function() {
		$('.nav_controls.left').fadeTo("fast",0.5);
	}, function() {
	  $('.nav_controls.left').fadeTo("fast", 0);
 	});

 	$(".nav_controls.right, .nav_controls.left").hover(function() {
 		$(this).fadeTo("fast",0.8);
 	}, function() {
	  $(this).fadeTo("fast", 0.5);
 	});


	$('.nav_controls.right').click(function() {
		var scrollVal = $('html').scrollLeft() + $('body').scrollLeft() + 300;
	  $('body, html').animate({scrollLeft:scrollVal}, 'slow');
	});

	$('.nav_controls.left').click(function() {
		var scrollVal = $('html').scrollLeft() + $('body').scrollLeft() - 300;
	  $('body, html').animate({scrollLeft:scrollVal}, 'slow');
	});

	$(".iconaddcontributor, .playslideshow").click(function() {
		$(this).fadeTo('fast',1);
	});

	$(".newbox").hover(function() {
		$(this).find(".box-text").fadeTo(50,0.5);
		$(this).find(".box-user").fadeTo(50,0.5);
		$(this).find(".storyimage").fadeTo(50,0.8);
		$(this).find(".box-timestamp").fadeTo(50,0.5);
		$(this).find(".story-edit-btn").fadeTo(50,1);
		$(this).find(".like-btn").fadeTo(50,1);

	}, function() {
		$(this).find(".box-text").fadeTo(50,1);
		$(this).find(".box-user").fadeTo(50,1);
		$(this).find(".storyimage").fadeTo(50,1);
		$(this).find(".box-timestamp").fadeTo(50,1);
   	$(this).find(".story-edit-btn").fadeTo(50,0);
   	$(this).find(".like-btn").fadeTo(50,0);
 	});

	$(".playslideshow").click(function() {
		$('#slideshow').removeClass("hide");
	 	$('.flexslider').flexslider({
	    	animation: "slide"
		});
	});

	$('#newmemory').collapse("hide");
	
	$('[placeholder]').focus(function() {
	  var input = $(this);
	  if (input.val() == input.attr('placeholder')) {
	    input.val('');
	    input.removeClass('placeholder');
	  }
	}).blur(function() {
	  var input = $(this);
	  if (input.val() == '' || input.val() == input.attr('placeholder')) {
	    input.addClass('placeholder');
	    input.val(input.attr('placeholder'));
	  }
	}).blur();

	$('[placeholder]').parents('form').submit(function() {
	  $(this).find('[placeholder]').each(function() {
	    var input = $(this);
	    if (input.val() == input.attr('placeholder')) {
	      input.val('');
	    }
	  })
	});
	
	$('.addphoto-icon, .adddate-icon ').hover(function() {
		$(this).fadeTo('fast',1);
	}, function() {
   	$(this).fadeTo("fast", 0.6);
 	});


 	$('.addphoto-icon').click(function() {
 		$('.addphoto-icon').fadeTo('fast',1);
 		$('.addphoto').toggleClass("hidden"); 
 		if (! $('.adddate').hasClass("hidden")){ 
 			$('.adddate').addClass("hidden");
 		}
 	});

 	$('.adddate-icon').click(function() {

 		$('.adddate-icon').fadeTo('fast',1);
 		$('.adddate').toggleClass("hidden");
 		if (! $('.addphoto').hasClass("hidden")){ 
 			$('.addphoto').addClass("hidden");
 		}
 	});

 	$('.suggest-icon').hover(function() {
		$(this).fadeTo('fast',1);
	}, function() {
   	$(this).fadeTo("fast", 0.6);
 	});

 	$('.suggeststory').click(function() {
 		$('.suggeststory').fadeTo('fast',0);
 		$('.memoryquestion').toggle("hidden");
 		//$('.messageSection').toggleClass ("withphoto");
 		//$('.messageBox').toggleClass ("withphoto");
 	});

	$('.skipquestion').click(function() {
		skipQuestion();
		resetQuestion();
 	});

 	$('#memorycounter').text('250');
	$('#memory_content').keyup(function (e) {
		if((e.which == 13)) {
	      e.preventDefault();
	      return false;
	    }
	    var left = 250 - $(this).val().length;
	    if (left < 0) {
	        $('#memorycounter').addClass("text-error");
	    }
	    $('#memorycounter').text(left);
		    
	});

	$('#newmemorymodal, #addcontributor').on('show', function () {
		$('body, html').scrollLeft(0);
		$("body").mousewheel(function(event) {
      $(this).unbind('mousewheel').mousewheel();
    });
  });

  $('#newmemorymodal, #addcontributor').on('hide', function () {
		$("body").mousewheel(function(event, delta) {
      this.scrollLeft -= (delta * 30);
      event.preventDefault();
    });
  });

	$('.coachmarks').click(function() {
		$('.modal.in').modal('hide') 
	});

	$('.firststories-coachmark, .addmemory-coachmark').click(function() {
		$('.modal.in').modal('hide') 
	});


	$('#newuserstorybook').on('show', function () {
	    $('.coachmarks').removeClass('hide');
	});

	$('#newuserstorybook').on('hide', function () {
	    $('.coachmarks').addClass('hide');
	});


	$('#zoomstory').on('show', function () {
	   $('body, html').css('cssText' , 'overflow-x: hidden !important;');
	});

	$('#zoomstory').on('hide', function () {
    $('body, html').css('cssText' , 'overflow-x: visible !important;');
	});

	var $container = $('#content');


	// use this if you want to use the spinner
	$(".savestory_button").click(function(){
		$('#newmemorymodal').modal('hide');
	 	$('#loading_spinner').modal('show');
	});

	$('#loading_spinner').on('show', function () {
	    $('.loading-spinner-icon').removeClass('hide');
	});

	$('#loading_spinner').on('hide', function () {
	    $('.loading-spinner-icon').addClass('hide');
	
	});



  $container.imagesLoaded(function() {
    $container.isotope({
      itemSelector : '.newbox', 
     /* filter: '*',*/
      layoutMode: 'masonryHorizontal',
      animationEngine: 'jquery',
      animationOptions: {
         easing: 'linear',
         queue: false,
       }
    });
  });

});
